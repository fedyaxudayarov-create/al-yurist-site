async function runSearch(){
    const text = txt.value.trim();
    if(!text) return;

    results.innerHTML = "";
    stat.textContent = "ü§ñ AI –Æ—Ä–∏—Å—Ç —û–π–ª–∞–º–æ“õ–¥–∞...";
    
    try {
        const r = await fetch("/api/search", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ cat, mode, text })
        });
        const data = await r.json();
        
        if(!data.ok){
            stat.textContent = "–•–∞—Ç–æ–ª–∏–∫ —é–∑ –±–µ—Ä–¥–∏: " + (data.error || "");
            return;
        }

        stat.textContent = "";
        let finalHtml = "";

        // ü§ñ AI –∂–∞–≤–æ–±–∏–Ω–∏ —á–∏“õ–∞—Ä–∏—à
        if(data.ai_comment){
            finalHtml += `
                <div class="ai-box" style="background: #eef6ff; border-left: 5px solid #007bff; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                    <h3 style="margin-top:0; color:#007bff;">‚ú® AI –ú–∞—Å–ª–∞“≥–∞—Ç–∏:</h3>
                    <div style="font-size: 1.1em; color: #333;">${data.ai_comment.replace(/\n/g, '<br>')}</div>
                </div>
            `;
        }

        // üìö –ë–∞–∑–∞–¥–∞–Ω —Ç–æ–ø–∏–ª–≥–∞–Ω –º–æ–¥–¥–∞–ª–∞—Ä–Ω–∏ —á–∏“õ–∞—Ä–∏—à
        const list = data.results || [];
        if(list.length > 0){
            finalHtml += `<h4 style="margin-bottom:10px;">–ú–∞–Ω–±–∞ —Å–∏—Ñ–∞—Ç–∏–¥–∞ —Ñ–æ–π–¥–∞–ª–∞–Ω–∏–ª–≥–∞–Ω –º–æ–¥–¥–∞–ª–∞—Ä:</h4>`;
            finalHtml += list.map(it=>`
                <div class="item" style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; background: #fff;">
                    <div class="item-head" style="display:flex; justify-content:space-between;">
                        <strong>${it.code_title} ‚Äî –ú–æ–¥–¥–∞ ${it.article_no}</strong>
                        <a href="${it.url}" target="_blank" class="link">lex.uz ‚Üó</a>
                    </div>
                    <div class="item-text" style="margin-top:10px; font-size: 0.9em; color: #555;">${it.snippet}</div>
                </div>
            `).join("");
        } else {
            finalHtml += `<div class="empty">–ë–∞–∑–∞–¥–∞–Ω –∞–Ω–∏“õ –º–æ–¥–¥–∞ —Ç–æ–ø–∏–ª–º–∞–¥–∏.</div>`;
        }

        results.innerHTML = finalHtml;

    } catch(e) {
        stat.textContent = "–£–ª–∞–Ω–∏—à–¥–∞ —Ö–∞—Ç–æ–ª–∏–∫.";
    }
}
